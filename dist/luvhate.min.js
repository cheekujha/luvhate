/*! luvhate 03-06-2015 */
!function(window,angular){angular.module("facebook",[])}(window,angular),function(window,angular){function facebookFactory($q){function browserInit(id,version){this.appID=id,this.appVersion=version||"v2.0",facebookConnectPlugin.browserInit(this.appID,this.appVersion)}function login(permissions){var q=$q.defer();return facebookConnectPlugin.login(permissions,function(res){q.resolve(res)},function(res){q.reject(res)}),q.promise}function showDialog(options){var q=$q.defer();return facebookConnectPlugin.showDialog(options,function(res){q.resolve(res)},function(err){q.reject(err)}),q.promise}function api(path,permissions){var q=$q.defer();return facebookConnectPlugin.api(path,permissions,function(res){q.resolve(res)},function(err){q.reject(err)}),q.promise}function getAccessToken(){var q=$q.defer();return facebookConnectPlugin.getAccessToken(function(res){q.resolve(res)},function(err){q.reject(err)}),q.promise}function getLoginStatus(){var q=$q.defer();return facebookConnectPlugin.getLoginStatus(function(res){console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>",res),lastLoginStatusAt=Date.now(),q.resolve(res)},function(err){q.reject(err)}),q.promise}function isLoggedIn(){if(isValidToken()){var dummyDefer=$q.defer();return dummyDefer.resolve(),dummyDefer.promise}return getLoginStatus()}function isValidToken(){return!1}function logout(){var q=$q.defer();return facebookConnectPlugin.logout(function(res){q.resolve(res)},function(err){q.reject(err)}),q.promise}var lastLoginStatusAt;return{browserInit:browserInit,login:login,showDialog:showDialog,api:api,getAccessToken:getAccessToken,getLoginStatus:getLoginStatus,logout:logout,isLoggedIn:isLoggedIn}}angular.module("facebook").factory("facebookFactory",facebookFactory),facebookFactory.$inject=["$q"]}(window,angular),function(window,angular){angular.module("login",[])}(window,angular),function(window,angular){function loginCtrl($scope,facebookFactory,$state,userFactory){function init(){initMethods()}function initMethods(){vm.facebookLogin=facebookLogin}function facebookLogin(){facebookFactory.login(["user_friends","public_profile"]).then(loginSuccess,loginError)}function loginSuccess(response){facebookFactory.api("/me",[]).then(function(me){myInformationSuccess(me,response.authResponse.accessToken)},myInformationError),console.log("facebookLogin success",response)}function loginError(response){console.log("facebookLogin error",response),$state.go("home.login")}function myInformationSuccess(me,accessToken){console.log("....myInformationSuccess.....",me);var userObj={name:me.name?me.name:null,fb_id:me.id,gender:me.gender,logged_in:1,access_token:accessToken};userFactory.createUserOnServer(userObj).then(userCreateOnServerSuccess,userCreateOnServerError)}function userCreateOnServerSuccess(user){console.log("........userCreateOnServerSuccess......",user),userFactory.createUserOnLocal(user).then(userCreateOnLocalSuccess,userCreateOnLocalError)}function userCreateOnServerError(){$state.go("home")}function myInformationError(err){console.log("....myInformationError.....",err)}function userCreateOnLocalSuccess(user){userFactory.setCurrentUser(user),$state.go("home.profile")}function userCreateOnLocalError(err){}var vm=this;init()}angular.module("login").controller("loginCtrl",loginCtrl),loginCtrl.$inject=["$scope","facebookFactory","$state","userFactory"]}(window,angular),function(window,angular){angular.module("peopleSearch",[])}(window,angular),function(window,angular){function peopleSearchCtrl($scope,peopleSearchFactory,friendSearchFactory,stateFactory,$state){function init(){vm.peopleList=[],vm.showLoadMoreButton=!1,vm.friendList=[],vm.friendListLoaded=!1,initMethods()}function initMethods(){vm.searhclicked=searhclicked,vm.loadMoreClicked=loadMoreClicked,vm.getFriendList=getFriendList,vm.loadMoreFriendClicked=loadMoreFriendClicked,vm.backClicked=backClicked}function backClicked(){console.log(">>>>>>>>>dasdmasbdhjasdjhabdhjabshjdabhsjd"),$state.go("home")}function searhclicked(searchText){searchText&&searchText.trim().length>0?(searchTextEntered=searchText,peopleSearchFactory.search(searchText,"user").then(function(list){peopleSearchSuccess(list,!0)},peopleSearchError)):searchTextEntered=null}function peopleSearchSuccess(list,emptyList){if(console.log("searchSuccess",list),list.length>0?vm.showLoadMoreButton=!0:vm.showLoadMoreButton=!1,emptyList&&(vm.peopleList=[],vm.peopleList.length=0),searchTextEntered){var i,l,searchArray=searchTextEntered.split(" ");list=list.filter(function(item){var returnVal=!1;for(i=0,l=searchArray.length;l>i;i+=1){var currentSearchText=searchArray[i].toLowerCase();if(item.name.toLowerCase().indexOf(currentSearchText)>=0){returnVal=!0;break}}return returnVal})}var oldList=vm.peopleList,newList=oldList.concat(list);vm.peopleList=newList}function peopleSearchError(){console.error("searchError")}function loadMoreClicked(){peopleSearchFactory.nextSearch().then(function(list){peopleSearchSuccess(list,!1)},peopleSearchError)}function getFriendList(){vm.friendListLoaded||friendSearchFactory.search().then(friendSearchSuccess,friendSearchError)}function friendSearchSuccess(list){list.length>0?vm.showFriendLoadMoreButton=!0:vm.showFriendLoadMoreButton=!1;var oldList=vm.friendList,newList=oldList.concat(list);vm.friendList=newList,vm.friendListLoaded=!0}function friendSearchError(response){console.log("friendSearchError",response)}function loadMoreFriendClicked(){friendSearchFactory.nextSearch().then(friendSearchSuccess,friendSearchError)}var searchTextEntered,vm=this;init()}angular.module("peopleSearch").controller("peopleSearchCtrl",peopleSearchCtrl),peopleSearchCtrl.$inject=["$scope","peopleSearchFactory","friendSearchFactory","stateFactory","$state"]}(window,angular),function(window,angular){function friendSearchFactory(facebookFactory,$q){function search(){var defer=$q.defer(),path="/me/friends?debug=all";return nextSearchPath=null,friendList=[],facebookFactory.api(path,["user_friends"]).then(function(response){response&&(setFriendList(response.data),setPaginationValues(response.data,response.paging)),defer.resolve(friendList)},function(response){defer.reject()}),defer.promise}function setFriendList(list){list&&list.length>0&&(friendList=friendList.concat(list))}function setPaginationValues(list,pagingData){nextSearchPath=list.length>0&&pagingData?formatNextPath(pagingData.next):null}function nextSearch(){var defer=$q.defer();return nextSearchPath?facebookFactory.api("me/"+nextSearchPath,["user_friends"]).then(function(response){response&&(setFriendList(response.data),setPaginationValues(response.data,response.paging)),defer.resolve(response.data)},function(response){defer.reject(response)}):defer.resolve([]),defer.promise}function formatNextPath(path){if(path){var indexOfSearch=path.indexOf("friends");return indexOfSearch>=0?path.substring(indexOfSearch):null}return null}var friendList=[],nextSearchPath=null;return{search:search,nextSearch:nextSearch}}angular.module("peopleSearch").factory("friendSearchFactory",friendSearchFactory),friendSearchFactory.$inject=["facebookFactory","$q"]}(window,angular),function(window,angular){function peopleSearchFactory(facebookFactory,$q){function search(query,type){var defer=$q.defer(),path="/search?q="+query+"&type="+type;return nextSearchPath=query,nextSearchPath=null,facebookFactory.api(path,[]).then(function(response){response&&(setPeopleList(response.data,!0),setPaginationValues(response.data,response.paging)),defer.resolve(peopleList)},function(response){defer.reject()}),defer.promise}function setPeopleList(list,emptyList){emptyList&&(peopleList=[],peopleList.length=0),list&&list.length>0&&(peopleList=peopleList.concat(list))}function setPaginationValues(list,pagingData){nextSearchPath=list.length>0&&pagingData?formatNextPath(pagingData.next):null}function nextSearch(){var defer=$q.defer();return nextSearchPath?facebookFactory.api(nextSearchPath,[]).then(function(response){response&&(setPeopleList(response.data,!1),setPaginationValues(response.data,response.paging)),defer.resolve(response.data)},function(response){defer.reject(response)}):defer.resolve([]),defer.promise}function formatNextPath(path){if(path){var indexOfSearch=path.indexOf("search");return indexOfSearch>=0?path.substring(indexOfSearch):null}return null}var peopleList=[],nextSearchPath=null;return{search:search,nextSearch:nextSearch}}angular.module("peopleSearch").factory("peopleSearchFactory",peopleSearchFactory),peopleSearchFactory.$inject=["facebookFactory","$q"]}(window,angular),function(window,angular){angular.module("searchListItem",[])}(window,angular),function(window,angular){function searchListItemCtrl($scope,userFactory){function init(){initMethods()}function initMethods(){$scope.toggleButtonPanel=toggleButtonPanel,$scope.relationButtonClicked=relationButtonClicked,self.checkRelation=checkRelation}function checkRelation(){var id=$scope.profile.id,isRelationPresent=userFactory.checkRelationWithId(id);if(isRelationPresent){var relation=userFactory.getRelationWithId(id);$scope.profile.heartType=relation.type?relation.type:void 0}}function toggleButtonPanel(){}function relationButtonClicked(type){var profile=$scope.profile;userFactory.postRelation(profile.id,profile.name,type).then(postRelationSuccess,postRelationError)}function postRelationSuccess(response){console.log(">.........postRelationSuccess.............".response),response&&($scope.profile.heartType=response.type?response.type:void 0,$scope.profile.showButtonPanel=!1)}function postRelationError(response){console.log(">.........postRelationError.............".response)}var self=this;init()}angular.module("searchListItem").controller("searchListItemCtrl",searchListItemCtrl),searchListItemCtrl.$inject=["$scope","userFactory"]}(window,angular),function(window,angular){function searchListItem(){return{restrict:"E",scope:{profile:"="},templateUrl:"modules/search-list-item/partials/SearchListItem.html",controller:"searchListItemCtrl",link:function(scope,element,attrs,ctrl){ctrl.profile=scope.profile,ctrl.checkRelation(),scope.$watch("profile",function(newVal,oldVal){newVal&&(ctrl.profile=scope.profile,ctrl.checkRelation())})}}}angular.module("searchListItem").directive("searchListItem",searchListItem),searchListItem.$inject=[]}(window,angular),function(window,angular){angular.module("userProfile",[])}(window,angular),function(window,angular){function userProfileCtrl($scope,facebookFactory,$state,$http,userFactory,facebookEnums){function init(){console.log("user progfile ctrk init"),initMethods(),setUser(),getUpdatedUserFromServer()}function initMethods(){vm.logoutClicked=logoutClicked,vm.backClicked=backClicked}function backClicked(){console.log("back clicked")}function getUpdatedUserFromServer(){userFactory.updateUserFromServer().then(updateUserFromServerSuccess,updateUserFromServerError)}function updateUserFromServerSuccess(response,status){if(response){var user=response[0];userFactory.updateUserOnLocal(user).then(updateUserOnLocalSuccess,updateUserOnLocalError)}else userFactory.deleteCurrentUserFromLocal().then(deleteCurrentUserFromLocalSuccess,deleteCurrentUserFromLocalError)}function deleteCurrentUserFromLocalSuccess(){$state.go("home.login")}function deleteCurrentUserFromLocalError(){}function updateUserFromServerError(response){console.error("updateUserFromServerError")}function updateUserOnLocalSuccess(savedUser){setUser()}function updateUserOnLocalError(){}function setUser(){vm.user=userFactory.getCurrentUser(),vm.imageWidth=$(".user-image").outerHeight()-20}function logoutClicked(){facebookFactory.logout().then(logoutSuccess,function(){alert("logout error")})}function logoutSuccess(){$state.go("home.login")}var vm=this;init()}angular.module("userProfile").controller("userProfileCtrl",userProfileCtrl),userProfileCtrl.$inject=["$scope","facebookFactory","$state","$http","userFactory","facebookEnums"]}(window,angular),function(window,angular){angular.module("common",[])}(window,angular),function(window,angular){function facebookEnums(){return{status:{connected:"connected",notAuthorized:"not_anuthorized",unknown:"unknown"}}}angular.module("common").constant("facebookEnums",facebookEnums())}(window,angular),function(window,angular){function urlConfig(){var host="http://192.168.0.52:3434/";return{user:host+"user",fbRelation:host+"fbRelation"}}angular.module("common").constant("urlConfig",urlConfig())}(window,angular),function(window,angular){function mainCtrl($scope,$timeout,facebookFactory,$window,facebookEnums,$state,databaseFactory,userFactory,phonegapFactory,$q){function init(){initMethods(),initListeners()}function initMethods(){}function initListeners(){console.log("main ctrk init"),$q.when(phonegapFactory.isDeviceReady()).then(onDeviceReady,function(){console.error("Device Ready Resolve Rejected")})}function startApp(){Oracle.DESKTOP&&facebookFactory.browserInit("584636644972667"),Database.isDatabaseInitialized()?userFactory.getLoggedInUser().then(function(){$state.go(".profile")},function(){$state.go(".login")}):Database.initialize(function(){userFactory.getLoggedInUser().then(function(){$state.go(".profile")},function(){$state.go(".login")})})}function onDeviceReady(){console.log("device ready"),startApp()}init()}angular.module("common").controller("mainCtrl",mainCtrl),mainCtrl.$inject=["$scope","$timeout","facebookFactory","$window","facebookEnums","$state","databaseFactory","userFactory","phonegapFactory","$q"]}(window,angular),function(window,angular){function baseFactory($q,$http,$log){return{doXHRGet:function(url,params,options){var deferred=$q.defer();return console.log("2"),$http({method:"GET",url:url}).success(function(data,status,headers,config){$log.info(data,status,headers(),config),deferred.resolve(data),console.log("3")}).error(function(data,status,headers,config){$log.warn(data,status,headers(),config),deferred.reject(data,status)}),deferred.promise},doXHRPost:function(url,data,options){var deferred=$q.defer();return $http({method:"POST",url:url,data:data}).success(function(data,status,headers,config){$log.info(data,status,headers(),config),deferred.resolve(data,status)}).error(function(data,status,headers,config){$log.warn(data,status,headers(),config),deferred.reject(data,status)}),deferred.promise},getServiceURL:function(url){return url}}}angular.module("common").factory("baseFactory",baseFactory),baseFactory.$inject=["$q","$http","$log"]}(window,angular),function(window,angular){function databaseFactory($q){function initialize(){if(database.isDatabaseInitialized)return!0;var defer=$q.defer();return database.initialize(function(){defer.resolve()}),defer.promise}function execute(query){var defer=$q.defer;return db.transaction(function(tx){tx.executeSql(query,[],function(tx,results){defer.resolve(results.row)})}),defer.promise}function getResultRow(result,index){return result.rows.item(index)}return{initialize:initialize,execute:execute,getResultRow:getResultRow}}angular.module("common").factory("databaseFactory",databaseFactory),databaseFactory.$inject=["$q"]}(window,angular),function(window,angular){function iframeFactory($q,$timeout){function initialize(){window.attachEvent?window.attachEvent("onmessage",processPostMessage):window.addEventListener("message",processPostMessage,!1)}function processPostMessage(event){console.log(".................",event);var message=event.data;"login"===message.eventType?(console.log("....................",window.parent),window.parent.postMessage({eventType:"login_status",status:"success"},"*")):"logout"===message.eventType&&window.parent.postMessage({eventType:"logout_status",status:"success"},"*")}return{initialize:initialize}}angular.module("common").factory("iframeFactory",iframeFactory),iframeFactory.$inject=["$q","$timeout"]}(window,angular),function(window,angular){function phonegapFactory($q){function isDeviceReady(){return deviceReady?!0:deviceReadyDefer.promise}var deviceReady=!1,deviceReadyDefer=$q.defer();return window.document.addEventListener("deviceready",function(event){deviceReady=!0,deviceReadyDefer.resolve()},!1),{isDeviceReady:isDeviceReady}}angular.module("common").factory("phonegapFactory",phonegapFactory),phonegapFactory.$inject=["$q"]}(window,angular),function(window,angular){function stateFactory(){function setPreviousState(stateName,stateParams){stateName&&(previousStateName=stateName,previousStateParams=stateParams?stateParams:{})}function getPreviousState(){return previousStateName?{stateName:previousStateName,params:previousStateParams}:void 0}var previousStateName,previousStateParams={};return{setPreviousState:setPreviousState,getPreviousState:getPreviousState}}angular.module("common").factory("stateFactory",stateFactory),stateFactory.$inject=[]}(window,angular),function(window,angular){function userFactory($q,databaseFactory,baseFactory,urlConfig){function userRelationsCheck(){var defer=$q.defer();return userRelation?defer.resolve():updateUserFromServer().then(function(response){response?updateUserOnLocal(response[0]).then(function(){defer.resolve()},function(){defer.reject()}):defer.reject()},function(){defer.reject()}),defer.promise}function checkRelationWithId(id){return userRelation&&userRelation[id]?!0:!1}function getRelationWithId(id){return userRelation&&userRelation[id]?userRelation[id]:null}function deleteCurrentUserFromLocal(){if(currentUser){var defer=$q.defer();return User.deleteRows({id:currentUser.id},function(){defer.resolve()}),defer.promise}}function postRelation(receiverId,receiverName,type){var url=urlConfig.fbRelation,data={from_id:currentUser.fb_id,from_name:currentUser.name,receiver_name:receiverName,receiver_id:receiverId,type:type};return baseFactory.doXHRPost(url,data,{})}function getLoggedInUser(){var defer=$q.defer();return User.findAllLoggedIn(function(users){console.log("..findAllLoggedIn.....",users),users&&users.length>0?(setCurrentUser(users[0]),defer.resolve(users[0])):defer.reject()}),defer.promise}function updateUserFromServer(){var id=currentUser.id,url=[urlConfig.user,"/",id].join("");return baseFactory.doXHRGet(url,{})}function createUserOnServer(userObj){var url=urlConfig.user;return baseFactory.doXHRPost(url,userObj)}function createUserOnLocal(userObj){var newUser=new User(userObj),defer=$q.defer();return newUser.save(!0,function(createdUser){defer.resolve(createdUser)}),defer.promise}function updateUserOnLocal(val){var defer;return defer=$q.defer(),currentUserModel?(updateUserRelations(val.relations),currentUserModel=angular.extend(currentUserModel,val),currentUserModel.save(function(){setCurrentUser(currentUserModel.dump()),defer.resolve()}),currentUser=currentUserModel.dump()):defer.reject(),defer.promise}function updateUserRelations(relations){var i,l;if(userRelation||(userRelation={}),relations&&relations.length>0)for(i=0,l=relations.length;l>i;i++)userRelation[relations[i].receiver_id]=relations[i]}function setCurrentUser(val){currentUser=val,currentUserModel||(currentUserModel=new User(val))}function getCurrentUser(){return currentUser}function isLoggedIn(){return currentUser?!0:!1}var currentUser,currentUserModel,userRelation;return{getLoggedInUser:getLoggedInUser,createUserOnServer:createUserOnServer,createUserOnLocal:createUserOnLocal,setCurrentUser:setCurrentUser,getCurrentUser:getCurrentUser,isLoggedIn:isLoggedIn,updateUserFromServer:updateUserFromServer,updateUserOnLocal:updateUserOnLocal,postRelation:postRelation,deleteCurrentUserFromLocal:deleteCurrentUserFromLocal,checkRelationWithId:checkRelationWithId,getRelationWithId:getRelationWithId,userRelationsCheck:userRelationsCheck}}angular.module("common").factory("userFactory",userFactory),userFactory.$inject=["$q","databaseFactory","baseFactory","urlConfig"]}(window,angular),function(window,angular){angular.module(window.APPNAME,["luvhate.templates","mobile-angular-ui","ui.router","common","facebook","login","userProfile","peopleSearch","searchListItem"]),angular.module(window.APPNAME).config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/home"),$stateProvider.state("home",{url:"/home",template:'<div ui-view class="router-view"></div>',controller:"mainCtrl",controllerAs:"vm"}).state("home.login",{templateUrl:"modules/login/partials/Login.html",controller:"loginCtrl",controllerAs:"vm"}).state("home.profile",{templateUrl:"modules/user-profile/partials/UserProfile.html",controller:"userProfileCtrl",controllerAs:"vm"}).state("search",{templateUrl:"modules/people-search/partials/PeopleSearch.html",url:"/search",controller:"peopleSearchCtrl",controllerAs:"vm",resolve:{user:["$q","userFactory",function($q,userFactory){var defer=$q.defer();return userFactory.isLoggedIn()?defer.resolve():defer.reject(),defer.promise}],fbLogin:["facebookFactory",function(facebookFactory){return console.log(">>>>>>facebookFactory>>>>>>"),facebookFactory.isLoggedIn()}],userRelations:["userFactory",function(userFactory){return userFactory.userRelationsCheck()}]}})}),angular.module(window.APPNAME).run(["$rootScope","$state","stateFactory",function($rootScope,$state,stateFactory){$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){event.preventDefault(),$state.go("home"),console.log("........stateChangeError..........",event,toState,toParams,fromState,fromParams,error)}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams,error){console.log("........stateChangeSuccess..........",event,toState,toParams,fromState,fromParams,error),stateFactory.setPreviousState(fromState.name,fromParams)})}])}(window,angular);